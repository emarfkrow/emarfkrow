# DB Design Guideline

**主キーおよび外部キーからテーブル間の関連情報を取得し、  
Entity・Validator・Action・HTMLなどWebアプリケーションに必要なファイルを出力します。**

---

## 主キー同士の関連

### １．親子パターン

主キー構成の一致関係により、テーブル間の親子関係を判定する。

- **親モデル**  
  主キーが先頭から一致し、かつ主キー数が一つだけ多いテーブルが存在する。

- **子モデル**  
  最終キー以前まで主キーが一致するテーブルが存在する。

### （親子パターン例外）

- **子なしモデル**  
  子モデルを設定しないテーブル。

- **孤児モデル**  
  親モデルを設定しないテーブル。

### ２．兄弟パターン

同一の主キー構成を持つテーブル間の関係を定義する。

- **兄弟モデル**  
  同一の主キーを持つテーブル。

### （兄弟パターン例外）

- **長兄モデル**  
  他のテーブルの兄弟として設定されないテーブル。

- **末弟モデル**  
  他のテーブルを兄弟として設定しないテーブル。

- **里子モデル**  
  兄弟関係の評価対象外とするテーブル。

### ３．履歴パターン

親子パターンを拡張し、履歴管理用テーブルを判定する。

- **履歴モデル**  
  - 親子パターンに該当する
  - 最終キーが連番キーで、変更理由カラムの有無に関わらず全項目が一致する  
  - 履歴元テーブル名が履歴テーブル名に前方一致する

---

## マスタ参照の関連

### １．参照パターン

- **参照モデル**  
  以下の条件をすべて満たすテーブル。
  - 「キー接尾辞：項目名接尾辞」の設定に該当する  
    主キーおよび列名が存在すること
  - 他のテーブルが、当該主キーを外部キーとして参照していること

- **再帰モデル**  
  自テーブルの主キーを外部キーとして参照しているテーブル。  
  この場合、参照関係は再帰的に評価される。

### 2. 複合パターン（Composite Pattern）

- **複合モデル**  
  - 参照パターンに該当する  
  - 二つ以上のテーブルについて、主キーを参照している
  - 複合モデルにおいては参照モデルのうち **主キーの一致数が最大となるテーブル** を参照先モデルとして採用する。
